# Инструкция по работе с бэкенд-приложением BankReviews

## Локальный запуск бэкенд-приложения

Для локального запуска бэкенд-приложения тебе потребуется:
- [Visual Studio](https://visualstudio.microsoft.com/) (советуем устанавливать Community версию);
- Локально запущенный сервер базы данных [PostgreSQL](https://www.postgresql.org/);

Проект, с которым тебе предстоит работать, расположен в папке `BankReviewsBackend`. Для запуска проекта тебе нужно:
- Открыть в Visual Studio решение `BankReviewsBackend/src/BankReviewApi/BankReviewApi.sln` и назначить в качестве запускаемого проекта `BankReviewApi`;
- Поменять в `appsettings.json` указанные `User ID` и `Password` на соответствующие данные своей локальной БД;
- Для запуска миграций в Package Manager Console прописать команду: `update-database`;
- Запустить проект.

## Тестовый проект

Для модульного тестирования проекта мы советуем использовать фреймворк xUnit. На [официальном сайте](https://xunit.net/) фреймворка представлена документация, в которой подробно описаны основные шаги для создания юнит-теста: от создания тестового проекта для модульного тестирования до написания и запуска своего первого теста. Используя данную документацию, создай тестовый проект, а после установи зависимости с другими проектами в решении, чтобы в дальнейшем использовать интерфейсы и классы в своих методах.

## Работа с локальной базой данных в тестовых методах

Безусловно, во время тестирования тебе потребуется напрямую взаимодействовать с базой данных. Использовать основную базу данных для подобных целей опасно, а в реальных условиях (когда приложение уже развёрнуто на машине заказчика) тестировать приложение подобным образом и вовсе запрещено. Поэтому для тестов тебе нужно использовать свою локально развёрнутую базу данных. Для этого тебе потребуется установить [PostgreSQL](https://www.postgresql.org/).

Однако конструкторы классов-репозиториев принимают на вход параметр типа Context, который по умолчанию создается при запуске проекта и подключается к своей базе данных. Чтобы упростить тебе задачу, мы написали класс, который позволяет легко получить необходимый контекст для локальной базы данных, и поместили его в файл `code-samples/PostgresAccessObject.cs`. Прежде чем запускать тесты, поменяй в методе `GetConnectionString` возвращаемую строку подключения (укажи там свои данные: id, пароль и пр.).

Примеры использования этого класса ты можешь найти в файле `code-samples/BankRepositoryTests.cs`. Там же представлен метод, который позволяет очищать базу данных (не забывай, что его можно использовать в методах `TearDown`, чтобы очищение выполнялось после прогона каждого теста).

## Моки

Чтобы тестировать метод в изоляции от прочих, тебе потребуются тестовые двойники. Для этого очень удобно использовать библиотеку [Moq](https://github.com/Moq/moq4/wiki/Quickstart). В репозитории этой библиотеки ты можешь ознакомиться с тем, как её можно установить и использовать.
